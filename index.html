<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Diagram</title>
  <style>
    body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background:#f6f7fb; }
    .wrap { max-width: 980px; margin: 24px auto; padding: 16px; }
    .card { background: #fff; border: 1px solid #e7e7ef; border-radius: 16px; padding: 16px; box-shadow: 0 6px 18px rgba(0,0,0,.06); }
    svg { width: 100%; height: auto; display: block; }
    .box { fill: #ffffff; stroke: #111827; stroke-width: 3; rx: 10; ry: 10; }
    .line { stroke: #111827; stroke-width: 5; fill: none; stroke-linecap: round; stroke-linejoin: round; }
    .label { font-size: 18px; fill: #111827; dominant-baseline: middle; }
    .hint { color:#6b7280; font-size: 14px; margin: 12px 2px 0; }
    .hud { display:flex; gap:12px; align-items:center; margin: 0 0 12px; color:#111827; }
    .pill { padding: 6px 10px; border: 1px solid #e7e7ef; border-radius: 999px; background:#fff; font-size: 14px; }
    .pill strong { font-weight: 700; }
    .statusDot { display:inline-block; width:10px; height:10px; border-radius:50%; margin-right:6px; background:#ef4444; vertical-align: -1px; }
    .statusDot.ok { background:#22c55e; }
    .statusDot.warn { background:#f59e0b; }
    .remoteDot { fill: #ef4444; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="hud">
        <div class="pill">Role: <strong id="roleLabel">?</strong></div>
        <div class="pill">You: <strong id="youLabel">?</strong></div>
        <div class="pill"><span id="wsDot" class="statusDot warn"></span><span id="wsLabel">Offline (local only)</span></div>
      </div>
      <!-- Responsive SVG; edit coordinates/sizes to match your sketch more closely -->
      <svg viewBox="0 0 900 1200" aria-label="Box diagram" id="map">
        <!-- CONNECTORS (draw first so they appear behind boxes) -->
        <!-- main vertical trunk -->
        <path class="line" d="M 505 190 L 505 845" />

        <!-- top-left connection (short horizontal into the trunk) -->
        <path class="line" d="M 480 215 L 505 215" />

        <!-- left-middle connection -->
        <path class="line" d="M 510 455 L 480 455" />

        <!-- top-right connection (step up then right, like the sketch) -->
        <path class="line" d="M 505 235 L 565 235 L 565 165 L 620 165" />

        <!-- middle-right connection (small step up then right) -->
        <path class="line" d="M 505 555 L 565 555 L 565 500 L 620 500" />

        <!-- bottom connection -->
        <path class="line" d="M 505 845 L 505 900" />

        <!-- BOXES -->
        <!-- top-left wide -->
        <rect class="box" x="60" y="120" width="420" height="170" />
        <text class="label" x="80" y="205">Frank room</text>

        <!-- left-middle (slightly larger and a bit lower) -->
        <rect class="box" x="90" y="320" width="390" height="280" />
        <text class="label" x="110" y="460">Lois room</text>

        <!-- top-right -->
        <rect class="box" x="620" y="115" width="250" height="190" />
        <text class="label" x="640" y="210">Spare room</text>

        <!-- middle-right -->
        <rect class="box" x="620" y="430" width="250" height="175" />
        <text class="label" x="640" y="520">Bathroom</text>

        <!-- bottom large -->
        <rect class="box" x="235" y="900" width="565" height="255" />
        <text class="label" x="255" y="1025">Mum dad room</text>
      </svg>
    </div>
  </div>
<script>
  // --- Multiplayer (simple WebSocket sync) ---
  // 1) Run a WebSocket server (example code in chat) on your LAN.
  // 2) Set WS_URL to that server (same network as players).
  const WS_URL = "ws://localhost:8080";

  const svg = document.getElementById('map');
  const roleLabel = document.getElementById('roleLabel');
  const youLabel = document.getElementById('youLabel');
  const wsDot = document.getElementById('wsDot');
  const wsLabel = document.getElementById('wsLabel');

  // Ask player role at start
  let role = null;
  while (role !== 'night guard' && role !== 'monster') {
    const ans = prompt("Are you a 'night guard' or 'monster'?");
    if (!ans) continue;
    role = ans.trim().toLowerCase();
  }
  roleLabel.textContent = role;

  // Your multiplayer id (assigned by server if connected)
  let myId = "local-" + Math.random().toString(16).slice(2);
  youLabel.textContent = myId;

  // Track one dot per player
  const dotsByPlayer = new Map(); // id -> SVGCircleElement

  function svgPointFromEvent(evt) {
    const pt = svg.createSVGPoint();
    const e = evt.touches && evt.touches[0] ? evt.touches[0] : evt;
    pt.x = e.clientX;
    pt.y = e.clientY;
    const ctm = svg.getScreenCTM();
    return ctm ? pt.matrixTransform(ctm.inverse()) : { x: 0, y: 0 };
  }

  function placeDotForPlayer(playerId, x, y, isMine = false) {
    // Remove existing dot for that player
    const existing = dotsByPlayer.get(playerId);
    if (existing) existing.remove();

    const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
    circle.setAttribute('class', isMine ? 'remoteDot' : 'remoteDot');
    circle.setAttribute('cx', x);
    circle.setAttribute('cy', y);
    circle.setAttribute('r', 10);
    svg.appendChild(circle);
    dotsByPlayer.set(playerId, circle);
  }

  // --- WebSocket wiring ---
  let ws = null;
  let wsConnected = false;

  function setWsStatus(state) {
    if (state === 'online') {
      wsDot.classList.remove('warn');
      wsDot.classList.add('ok');
      wsLabel.textContent = 'Online (multiplayer)';
    } else if (state === 'connecting') {
      wsDot.classList.remove('ok');
      wsDot.classList.add('warn');
      wsLabel.textContent = 'Connectingâ€¦';
    } else {
      wsDot.classList.remove('ok');
      wsDot.classList.add('warn');
      wsLabel.textContent = 'Offline (local only)';
    }
  }

  function safeSend(obj) {
    if (ws && wsConnected) {
      ws.send(JSON.stringify(obj));
      return true;
    }
    return false;
  }

  function connectWs() {
    setWsStatus('connecting');
    try {
      ws = new WebSocket(WS_URL);
    } catch (e) {
      setWsStatus('offline');
      return;
    }

    ws.addEventListener('open', () => {
      wsConnected = true;
      setWsStatus('online');
      // Join handshake
      safeSend({ type: 'join', role });
    });

    ws.addEventListener('message', (ev) => {
      let msg;
      try { msg = JSON.parse(ev.data); } catch { return; }

      if (msg.type === 'welcome' && msg.id) {
        myId = msg.id;
        youLabel.textContent = myId;
        return;
      }

      if (msg.type === 'state' && msg.dots) {
        // dots: { [playerId]: {x,y} }
        for (const [pid, p] of Object.entries(msg.dots)) {
          if (!p) continue;
          placeDotForPlayer(pid, p.x, p.y, pid === myId);
        }
        return;
      }

      if (msg.type === 'dot' && msg.id && msg.x != null && msg.y != null) {
        placeDotForPlayer(msg.id, msg.x, msg.y, msg.id === myId);
        return;
      }
    });

    ws.addEventListener('close', () => {
      wsConnected = false;
      setWsStatus('offline');
    });

    ws.addEventListener('error', () => {
      wsConnected = false;
      setWsStatus('offline');
    });
  }

  // Try to connect (if no server running, it will fall back to local-only)
  connectWs();

  // --- Input: only monsters can place dots ---
  function onPointer(evt) {
    // Prevent scrolling on touch
    if (evt.cancelable) evt.preventDefault();

    if (role !== 'monster') return;

    const p = svgPointFromEvent(evt);

    // Always place locally
    placeDotForPlayer(myId, p.x, p.y, true);

    // Also broadcast (if multiplayer is connected)
    safeSend({ type: 'dot', x: p.x, y: p.y });
  }

  // Pointer events work for mouse + touch + pen
  svg.addEventListener('pointerdown', onPointer, { passive: false });
</script>
</body>
</html>